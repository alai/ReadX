<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article æå–æ–¹æ¡ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #1da1f2;
            border-bottom: 2px solid #1da1f2;
            padding-bottom: 10px;
        }
        .selector-test {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 3px solid #28a745;
        }
        .selector-test.fail {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        .code {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }
        .success { color: #28a745; font-weight: bold; }
        .fail { color: #dc3545; font-weight: bold; }
        .info { color: #007bff; }
    </style>
</head>
<body>
    <h1>ğŸ“ X.com Article é¡µé¢å†…å®¹æå–æ–¹æ¡ˆæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ¯ æµ‹è¯•ç›®æ ‡</h2>
        <p>éªŒè¯ä» X.com å®˜æ–¹ Article é¡µé¢æå–é•¿æ–‡å†…å®¹çš„å¯è¡Œæ€§</p>
        <ul>
            <li>âœ… è¯†åˆ« Article å®¹å™¨</li>
            <li>âœ… æå–æ–‡ç« æ ‡é¢˜</li>
            <li>âœ… æå–æ–‡ç« æ­£æ–‡ï¼ˆDraft.js æ ¼å¼ï¼‰</li>
            <li>âœ… å¤„ç†ä¸åŒçš„å†…å®¹å—ï¼ˆæ®µè½ã€æ ‡é¢˜ã€åˆ—è¡¨ã€å›¾ç‰‡ç­‰ï¼‰</li>
            <li>âœ… ä¿æŒå†…å®¹ç»“æ„å’Œæ ¼å¼</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ” å…³é”®é€‰æ‹©å™¨è¯†åˆ«</h2>
        
        <div class="selector-test" id="test-article-container">
            <strong>1. Article å®¹å™¨è¯†åˆ«</strong>
            <div class="code">
// æ–¹æ³•1: é€šè¿‡ data-testid
const articleContainer = document.querySelector('[data-testid="twitterArticleRichTextView"]');

// æ–¹æ³•2: é€šè¿‡ DraftEditor ç±»
const draftEditor = document.querySelector('.DraftEditor-root');
            </div>
            <div class="result" id="result-article-container"></div>
        </div>

        <div class="selector-test" id="test-article-title">
            <strong>2. æ–‡ç« æ ‡é¢˜æå–</strong>
            <div class="code">
// æ ‡é¢˜é€‰æ‹©å™¨
const title = document.querySelector('[data-testid="twitter-article-title"]');
// æˆ–è€…
const titleAlt = document.querySelector('.longform-header-two, h2[class*="longform"]');
            </div>
            <div class="result" id="result-article-title"></div>
        </div>

        <div class="selector-test" id="test-article-content">
            <strong>3. æ–‡ç« å†…å®¹å—æå–</strong>
            <div class="code">
// Draft.js å†…å®¹å®¹å™¨
const contentBlocks = document.querySelectorAll('[data-block="true"]');

// ä¸åŒç±»å‹çš„å†…å®¹å—
// - æ®µè½: .longform-unstyled
// - æ ‡é¢˜: .longform-header-two
// - å¼•ç”¨: .longform-blockquote
// - åˆ—è¡¨: .longform-unordered-list-item, .longform-ordered-list-item
// - å›¾ç‰‡: section[data-block="true"] img
            </div>
            <div class="result" id="result-article-content"></div>
        </div>

        <div class="selector-test" id="test-text-extraction">
            <strong>4. æ–‡æœ¬æå–æ–¹æ³•</strong>
            <div class="code">
// æ–¹æ³•1: é€šè¿‡ data-text="true" çš„ span
const textSpans = block.querySelectorAll('span[data-text="true"]');
const text = Array.from(textSpans).map(span => span.textContent).join('');

// æ–¹æ³•2: ç›´æ¥ä½¿ç”¨ textContent (å¯èƒ½åŒ…å«é¢å¤–ç©ºæ ¼)
const text = block.textContent.trim();
            </div>
            <div class="result" id="result-text-extraction"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ æå–ç­–ç•¥åˆ†æ</h2>
        <div style="line-height: 1.8;">
            <h3>DOM ç»“æ„ç‰¹å¾ï¼š</h3>
            <ul>
                <li><strong>å®¹å™¨æ ‡è¯†ï¼š</strong> <code>data-testid="twitterArticleRichTextView"</code></li>
                <li><strong>ç¼–è¾‘å™¨æ¡†æ¶ï¼š</strong> Draft.js (<code>.DraftEditor-root</code>)</li>
                <li><strong>å†…å®¹å—ï¼š</strong> æ¯ä¸ªæ®µè½/æ ‡é¢˜éƒ½æ˜¯ç‹¬ç«‹çš„ <code>data-block="true"</code> å…ƒç´ </li>
                <li><strong>æ–‡æœ¬æ ‡è®°ï¼š</strong> å®é™…æ–‡æœ¬å†…å®¹åœ¨ <code>span[data-text="true"]</code> ä¸­</li>
            </ul>

            <h3>æå–ç­–ç•¥ï¼š</h3>
            <ol>
                <li><strong>æ£€æµ‹ Article é¡µé¢ï¼š</strong>
                    <ul>
                        <li>æŸ¥æ‰¾ <code>[data-testid="twitterArticleRichTextView"]</code></li>
                        <li>ç¡®è®¤å­˜åœ¨ Draft.js ç»“æ„</li>
                    </ul>
                </li>
                <li><strong>æå–æ ‡é¢˜ï¼š</strong>
                    <ul>
                        <li>ä¼˜å…ˆä½¿ç”¨ <code>[data-testid="twitter-article-title"]</code></li>
                        <li>å¤‡ç”¨ï¼šç¬¬ä¸€ä¸ª <code>.longform-header-two</code></li>
                    </ul>
                </li>
                <li><strong>æå–æ­£æ–‡ï¼š</strong>
                    <ul>
                        <li>éå†æ‰€æœ‰ <code>[data-block="true"]</code></li>
                        <li>æ ¹æ® class åˆ¤æ–­å—ç±»å‹ï¼ˆæ®µè½ã€æ ‡é¢˜ã€å¼•ç”¨ã€åˆ—è¡¨ï¼‰</li>
                        <li>æå– <code>span[data-text="true"]</code> çš„æ–‡æœ¬</li>
                        <li>ä¿æŒå—çš„å±‚çº§å…³ç³»å’Œæ ¼å¼</li>
                    </ul>
                </li>
                <li><strong>å¤„ç†å›¾ç‰‡ï¼š</strong>
                    <ul>
                        <li>æŸ¥æ‰¾ <code>section[data-block="true"]</code> ä¸­çš„å›¾ç‰‡</li>
                        <li>æå–å›¾ç‰‡ URL å’Œ alt æ–‡æœ¬</li>
                    </ul>
                </li>
            </ol>

            <h3>ä¸ç°æœ‰æ¨æ–‡æå–çš„å¯¹æ¯”ï¼š</h3>
            <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="border: 1px solid #dee2e6; padding: 8px;">ç‰¹æ€§</th>
                        <th style="border: 1px solid #dee2e6; padding: 8px;">æ™®é€šæ¨æ–‡</th>
                        <th style="border: 1px solid #dee2e6; padding: 8px;">Article é¡µé¢</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">å®¹å™¨é€‰æ‹©å™¨</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;"><code>[data-testid="tweetText"]</code></td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;"><code>[data-testid="twitterArticleRichTextView"]</code></td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">å†…å®¹ç»“æ„</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">å•ä¸€æ®µè½ï¼Œå¯èƒ½æœ‰é“¾æ¥</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">å¤šå±‚çº§ï¼šæ ‡é¢˜ã€æ®µè½ã€å¼•ç”¨ã€åˆ—è¡¨</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">æ–‡æœ¬æå–</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">ç›´æ¥ textContent æˆ– innerHTML</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">éå† data-blockï¼Œæå– data-text span</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">æ ¼å¼ä¿æŒ</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">ç®€å•ï¼Œä¸»è¦æ˜¯æ¢è¡Œ</td>
                        <td style="border: 1px solid #dee2e6; padding: 8px;">å¤æ‚ï¼Œéœ€ä¿æŒå—ç±»å‹å’Œå±‚çº§</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="test-section">
        <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
        <ul>
            <li>Article é¡µé¢ä½¿ç”¨ Draft.js ç¼–è¾‘å™¨æ¡†æ¶ï¼ŒDOM ç»“æ„æ¯”æ™®é€šæ¨æ–‡å¤æ‚</li>
            <li>éœ€è¦å¤„ç†å¤šç§å†…å®¹å—ç±»å‹ï¼ˆæ®µè½ã€æ ‡é¢˜ã€å¼•ç”¨ã€åˆ—è¡¨ç­‰ï¼‰</li>
            <li>æ–‡æœ¬å†…å®¹åœ¨ <code>span[data-text="true"]</code> ä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ª span ç»„æˆä¸€æ®µ</li>
            <li>å›¾ç‰‡åµŒå…¥åœ¨ <code>section[data-block="true"]</code> ä¸­ï¼Œéœ€å•ç‹¬å¤„ç†</li>
            <li>å¯èƒ½åŒ…å«å†…åµŒçš„æ¨æ–‡ï¼ˆéœ€è¦é¢å¤–å¤„ç†ï¼‰</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>âœ… å®æ–½å»ºè®®</h2>
        <ol>
            <li><strong>æ£€æµ‹ä¼˜å…ˆçº§ï¼š</strong>
                <ul>
                    <li>å…ˆæ£€æŸ¥æ˜¯å¦ä¸º Article é¡µé¢ï¼ˆå­˜åœ¨ <code>twitterArticleRichTextView</code>ï¼‰</li>
                    <li>å¦‚æœæ˜¯ï¼Œä½¿ç”¨ Article ä¸“ç”¨æå–å™¨</li>
                    <li>å¦åˆ™ï¼Œä½¿ç”¨ç°æœ‰çš„æ¨æ–‡æå–å™¨</li>
                </ul>
            </li>
            <li><strong>æå–å™¨å®ç°ï¼š</strong>
                <ul>
                    <li>åˆ›å»º <code>ArticleExtractor</code> ç±»</li>
                    <li>å®ç° <code>extractTitle()</code> æ–¹æ³•</li>
                    <li>å®ç° <code>extractContent()</code> æ–¹æ³•ï¼Œéå†æ‰€æœ‰ data-block</li>
                    <li>å®ç° <code>extractImages()</code> æ–¹æ³•</li>
                </ul>
            </li>
            <li><strong>å†…å®¹é‡ç»„ï¼š</strong>
                <ul>
                    <li>å°†æå–çš„å—æŒ‰åŸå§‹é¡ºåºç»„åˆ</li>
                    <li>ä¿æŒæ®µè½ã€æ ‡é¢˜ã€å¼•ç”¨çš„æ ¼å¼</li>
                    <li>æ­£ç¡®å¤„ç†åˆ—è¡¨çš„åµŒå¥—</li>
                    <li>å›¾ç‰‡æ’å…¥åˆ°é€‚å½“ä½ç½®</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸš€ ä¸‹ä¸€æ­¥</h2>
        <ol>
            <li>åœ¨ <code>content.js</code> ä¸­æ·»åŠ  Article æ£€æµ‹é€»è¾‘</li>
            <li>å®ç° <code>ArticleExtractor</code> ç±»</li>
            <li>ä¿®æ”¹ <code>ReadingModeManager</code>ï¼Œæ”¯æŒ Article å†…å®¹</li>
            <li>è°ƒæ•´ CSS æ ·å¼ï¼Œé€‚é… Article çš„å¤šå±‚çº§ç»“æ„</li>
            <li>æµ‹è¯•ä¸åŒé•¿åº¦å’Œå¤æ‚åº¦çš„ Article é¡µé¢</li>
        </ol>
    </div>

    <script>
        // è¿™ä¸ªè„šæœ¬ä¼šåœ¨å®é™…çš„ X.com Article é¡µé¢ä¸­è¿è¡Œæµ‹è¯•
        function runTests() {
            const results = {
                articleContainer: false,
                articleTitle: false,
                articleContent: false,
                textExtraction: false
            };

            // æµ‹è¯• 1: Article å®¹å™¨è¯†åˆ«
            const articleContainer = document.querySelector('[data-testid="twitterArticleRichTextView"]');
            const draftEditor = document.querySelector('.DraftEditor-root');
            results.articleContainer = !!(articleContainer && draftEditor);
            updateResult('result-article-container', results.articleContainer, 
                articleContainer ? `âœ… æ‰¾åˆ° Article å®¹å™¨ï¼ŒåŒ…å« ${draftEditor.querySelectorAll('[data-block="true"]').length} ä¸ªå†…å®¹å—` : 
                'âŒ æœªæ‰¾åˆ° Article å®¹å™¨');

            // æµ‹è¯• 2: æ–‡ç« æ ‡é¢˜æå–
            const title = document.querySelector('[data-testid="twitter-article-title"]');
            results.articleTitle = !!title;
            updateResult('result-article-title', results.articleTitle,
                title ? `âœ… æ ‡é¢˜: "${title.textContent.trim().substring(0, 50)}..."` : 
                'âŒ æœªæ‰¾åˆ°æ ‡é¢˜');

            // æµ‹è¯• 3: æ–‡ç« å†…å®¹å—æå–
            const contentBlocks = document.querySelectorAll('[data-block="true"]');
            results.articleContent = contentBlocks.length > 0;
            if (contentBlocks.length > 0) {
                const blockTypes = {};
                contentBlocks.forEach(block => {
                    const classList = Array.from(block.classList);
                    const type = classList.find(c => c.startsWith('longform-')) || 'unknown';
                    blockTypes[type] = (blockTypes[type] || 0) + 1;
                });
                const typesSummary = Object.entries(blockTypes)
                    .map(([type, count]) => `${type}: ${count}`)
                    .join(', ');
                updateResult('result-article-content', results.articleContent,
                    `âœ… æ‰¾åˆ° ${contentBlocks.length} ä¸ªå†…å®¹å— (${typesSummary})`);
            } else {
                updateResult('result-article-content', results.articleContent,
                    'âŒ æœªæ‰¾åˆ°å†…å®¹å—');
            }

            // æµ‹è¯• 4: æ–‡æœ¬æå–
            if (contentBlocks.length > 0) {
                const firstBlock = contentBlocks[0];
                const textSpans = firstBlock.querySelectorAll('span[data-text="true"]');
                const text = Array.from(textSpans).map(span => span.textContent).join('');
                results.textExtraction = text.length > 0;
                updateResult('result-text-extraction', results.textExtraction,
                    text ? `âœ… æˆåŠŸæå–æ–‡æœ¬: "${text.substring(0, 100)}..."` : 
                    'âŒ æ–‡æœ¬æå–å¤±è´¥');
            } else {
                updateResult('result-text-extraction', false, 'â­ï¸ è·³è¿‡ï¼ˆæ— å†…å®¹å—ï¼‰');
            }

            // æ€»ç»“
            const passCount = Object.values(results).filter(v => v).length;
            const totalCount = Object.keys(results).length;
            console.log(`æµ‹è¯•å®Œæˆ: ${passCount}/${totalCount} é€šè¿‡`, results);
        }

        function updateResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<span class="${success ? 'success' : 'fail'}">${message}</span>`;
                const testSection = element.closest('.selector-test');
                if (testSection && !success) {
                    testSection.classList.add('fail');
                }
            }
        }

        // å½“é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }

        // æä¾›æ‰‹åŠ¨è¿è¡Œæµ‹è¯•çš„æŒ‰é’®
        const manualTestButton = document.createElement('button');
        manualTestButton.textContent = 'ğŸ”„ é‡æ–°è¿è¡Œæµ‹è¯•';
        manualTestButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; padding: 15px 30px; background: #1da1f2; color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 9999;';
        manualTestButton.onclick = runTests;
        document.body.appendChild(manualTestButton);
    </script>
</body>
</html>
